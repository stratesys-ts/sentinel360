{% extends 'base.html' %}

{% block title %}Tarefas{% endblock %}
{% block page_title %}Tarefas{% endblock %}

{% block extra_css %}
<style>
  .item-count {
    color: #6b7280;
    font-weight: 600;
    font-size: 0.75rem;
  }
</style>
{% endblock %}

{% block content %}
<div class="card">
  <div class="card-header d-flex align-items-center justify-content-between">
    <h3 class="mb-0" style="display: flex; align-items: baseline; gap: 0.4rem;">
      Minhas Tarefas
      <span class="item-count">({{ tasks|length }})</span>
    </h3>
  </div>
  <div class="table-container">
    <table class="table mb-0">
      <thead>
        <tr>
          <th>ID</th>
          <th>Titulo</th>
          <th>Projeto</th>
          <th>Prioridade</th>
          <th>Status</th>
          <th>Inicio</th>
          <th>Fim</th>
          <th style="text-align:center; width:110px;">Acoes</th>
        </tr>
      </thead>
      <tbody>
        {% for task in tasks %}
        <tr>
          <td style="width: 70px;">
            <a href="{% url 'projects:task_detail' task.id %}" style="color: var(--primary-color); font-weight: 600;">#{{ task.public_id|default:task.id }}</a>
          </td>
          <td>{{ task.title }}</td>
          <td>{{ task.project.name|default:"-" }}</td>
          <td>
            {% if task.priority == 'HIGH' %}
              <span class="badge badge-danger" style="background:#fde8e8; color:#9b1c1c;">Alta</span>
            {% elif task.priority == 'LOW' %}
              <span class="badge badge-secondary" style="background:#f4f5f7; color:#374151;">Baixa</span>
            {% else %}
              <span class="badge badge-info" style="background:#e0f2fe; color:#0f3e68;">Media</span>
            {% endif %}
          </td>
          <td>
            {% if task.status == 'DONE' %}
              <span class="badge badge-success" style="background:#def7ec; color:#0f5132;">Concluida</span>
            {% elif task.status == 'DOING' %}
              <span class="badge badge-info" style="background:#e0f2fe; color:#0f3e68;">Em andamento</span>
            {% else %}
              <span class="badge badge-secondary" style="background:#f4f5f7; color:#374151;">A fazer</span>
            {% endif %}
          </td>
          <td>{{ task.start_date|date:"d/m/Y"|default:"-" }}</td>
          <td>{{ task.due_date|date:"d/m/Y"|default:"-" }}</td>
          <td style="text-align:center;" class="text-nowrap">
            <a href="{% url 'projects:task_detail' task.id %}" title="Detalhes"
               style="color: var(--primary-color); margin-right:0.6rem; font-size:1.05rem;">
              <i class="fas fa-external-link-alt"></i>
            </a>
            {% if perms.projects.delete_task %}
            <form action="{% url 'projects:task_update' task.id %}" method="post" style="display:inline;">
              {% csrf_token %}
              <input type="hidden" name="action" value="delete">
              <input type="hidden" name="redirect_to" value="{{ request.get_full_path }}">
              <button type="submit" title="Excluir"
                style="background:none;border:none;color:#d9534f;font-size:1.05rem;cursor:pointer;padding:0 0.2rem;"
                onclick="return confirmDelete(event, this.form);">
                <i class="fas fa-trash-alt"></i>
              </button>
            </form>
            {% endif %}
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="8" class="text-center text-muted py-4">Nenhuma tarefa atribuida.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
