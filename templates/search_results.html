{% extends 'base.html' %}
{% block title %}Resultados da busca{% endblock %}

{% block content %}
<div class="card">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h5 class="mb-0">Resultados da busca</h5>
    <span class="text-muted small">Consulta: "{{ query|default_if_none:'' }}"</span>
  </div>
  <div class="card-body">
    {% if not query %}
      <p class="text-muted mb-0">Digite um termo de busca na barra superior para encontrar chamados, projetos, tarefas ou folhas de ponto.</p>
    {% else %}
      {% if results.tickets %}
        <h6 class="mt-2">Chamados</h6>
        <ul class="list-unstyled">
          {% for t in results.tickets %}
          <li class="mb-1">
            <a href="{% url 'helpdesk:ticket_detail' t.pk %}" class="text-decoration-none">
              <strong>#{{ t.id }}</strong> - {{ t.title }}
            </a>
          </li>
          {% endfor %}
        </ul>
      {% endif %}

      {% if results.projects %}
        <h6 class="mt-3">Projetos</h6>
        <ul class="list-unstyled">
          {% for p in results.projects %}
          <li class="mb-1">
            <a href="{% url 'projects:project_detail' p.pk %}" class="text-decoration-none">
              {{ p.name }}
            </a>
          </li>
          {% endfor %}
        </ul>
      {% endif %}

      {% if results.tasks %}
        <h6 class="mt-3">Tarefas</h6>
        <ul class="list-unstyled">
          {% for task in results.tasks %}
          <li class="mb-1">
            <a href="{% url 'projects:task_edit' task.pk %}" class="text-decoration-none">
              {{ task.title }}
            </a>
            <small class="text-muted">({{ task.get_status_display }})</small>
          </li>
          {% endfor %}
        </ul>
      {% endif %}

      {% if results.timesheets %}
        <h6 class="mt-3">Folhas de ponto</h6>
        <ul class="list-unstyled">
          {% for ts in results.timesheets %}
          <li class="mb-1">
            <a href="{% url 'timesheet:timesheet_detail' ts.pk %}" class="text-decoration-none">
              {{ ts.user.username }} â€” {{ ts.start_date|date:"d/m/Y" }} a {{ ts.end_date|date:"d/m/Y" }}
            </a>
            <small class="text-muted">({{ ts.get_status_display }})</small>
          </li>
          {% endfor %}
        </ul>
      {% endif %}

      {% if not results.tickets and not results.projects and not results.tasks and not results.timesheets %}
        <p class="text-muted mb-0">Nenhum resultado encontrado para "{{ query }}".</p>
      {% endif %}
    {% endif %}
  </div>
</div>
{% endblock %}
